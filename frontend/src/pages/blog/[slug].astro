---
// ./src/pages/blog/[slug].astro
import Layout from "../../layouts/Layout.astro";
// import PostDetail from '../../components/PostDetail.astro';
import PostDetail from "../../components/PostDetail.astro";
import { getPostBySlug, getAllPosts } from "../../utils/sanityQueries"; // Import the new helper function

export async function getStaticPaths() {
  const posts = await getAllPosts(); // Use the function from sanityQueries.ts to fetch all posts
  return posts.map((post) => ({
    params: { slug: post.slug.current },
  }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug); // Use the new helper function to fetch the post by slug
if (!post) throw new Error("Post not found");
---

<Layout>
  <PostDetail post={post} />
</Layout>
