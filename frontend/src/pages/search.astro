---
import { SEO } from "astro-seo";
import Layout from "../layouts/Layout.astro";
import Icon from "../components/Icon.astro";
import CategoryFilterList from "../components/CategoryFilterList.astro";
import { getBlogIndexData } from "../utils/getBlogIndexData";
import "../styles/search.css";

const { categories, categorySlug } = await getBlogIndexData({});

const SITE_URL = import.meta.env.PUBLIC_SITE_URL;
const canonicalUrl = `${SITE_URL}/search`;
---

<SEO
  title="Search Blog Posts"
  description="Search our blog posts by keyword, category, or tag to find content that resonates with you."
  canonical={canonicalUrl}
  openGraph={{
    basic: {
      title: "Search Blog Posts",
      type: "website",
      image: "",
      url: canonicalUrl,
    },
    optional: {
      siteName: "Your Site Name",
      locale: "en_US",
    },
  }}
  twitter={{
    title: "Search Blog Posts",
    description: "Search our blog posts by keyword, category, or tag.",
    card: "summary",
  }}
/>

<Layout>
  <div class="search-page">
    <section class="wrapper">
      <header>
        <h1>
          Find the Support You Need
          <Icon name="search" title="Search Icon" size={48} />
        </h1>
        <p class="search-page__subtitle">
          Search for blog posts by <span class="search-page__span">keyword</span
          >, <span class="search-page__span">category</span>, or <span
            class="search-page__span">tag</span
          >. Use the search bar below to find content that resonates with you.
        </p>
      </header>

      <div id="search" class="pagefind-ui"></div>
      <!-- <p>
      If you have any questions or need assistance, please contact us at
      <a href="mailto:your@email.com">your@email.com</a>
    </p> -->
    </section>

    <section class="search-page__categories">
      <CategoryFilterList
        categories={categories}
        categorySlug={categorySlug}
        heading="Search by Category"
        aria-label="Blog categories"
        class="search-page__categories-list"
      />
    </section>
  </div>
</Layout>

<script type="module">
  import "/pagefind/pagefind-ui.js";
  new PagefindUI({
    element: "#search",
    resetStyles: false, // inherit site styles
    autofocus: true,
    debounceTimeoutMs: 500,
    excerptLength: 150, // length of excerpt in characters,
    zero_results: "Couldn't find [SEARCH_TERM]",
    showEmptyFilters: false,
    translations: {
      placeholder: "Search blog posts...",
      zero_results: "Couldn't find [SEARCH_TERM]",
    },
  });

  // Add input limiter after Pagefind initializes
  setTimeout(() => {
    const input = document.querySelector(".pagefind-ui__search-input");
    if (input) {
      input.setAttribute("maxlength", "80");
    }
  }, 100); // brief delay to ensure input is rendered
</script>

<style>
  .search-page {
    padding-top: var(--spacing-xxl);
  }
  .search-page__categories {
    display: flex;
    justify-content: center;
    margin-bottom: var(--spacing-xl);
  }
</style>
