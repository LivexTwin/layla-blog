---
import SanityImage from "./sanity/SanityImage.astro";
import PortableText from "./sanity/PortableText.astro";
import PostMeta from "./PostMeta.astro";
import CopyLinkButton from "./CopyLinkButton.astro";

const { post } = Astro.props;

const hasImage = !!post.mainImage;
---

<article data-pagefind-body>
  <div class="post-detail__hero">
    {
      hasImage && (
        <SanityImage
          class="post-detail_hero img"
          image={post.mainImage}
          maxWidth={1000}
          loading="eager"
        />
      )
    }

    <h1>{post.title}</h1>
  </div>

  <svg
    class="decorative-svg"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="3.97 9.53 16.27 3.7"
    ><path
      fill="#a6bcb2"
      d="M17.37 9.54c-.37.12-.98.24-.98.24s-.82.07-1.78.17c-.96.1-1.76.45-1.76.45l-.5.3s-.56.44-.84.62c-.28.18-.72.53-.72.53l-.68.74-.53.25-.49.14.05.12.41-.09.68-.12s1.3-.06 2-.04c.7.03 1.35-.3 1.64-.4.28-.1 1.53-.88 1.77-1.02s1.97-1.69 1.97-1.69c.01-.13-.1-.23-.21-.19Zm-.67.85-.38.31-.19.16-.84.62-.44.25-.62.37-.79.32-.29.08-.32.1-.27.05-.4.07-.6.05-.57-.03h-.25l-.01-.01c-.03-.01-.15-.07.05-.1.23-.03.59-.09.59-.09l.8-.08.13-.02s.16.03.12 0c-.04-.02-.07-.05-.16-.06-.08 0-.2.02-.22.02l-.18.02h-.14s-.06-.06-.03-.09c.01-.01.03-.03.06-.04.12-.04.34-.11.34-.11l.2-.05.36-.18.48-.21.3-.15.24-.1.35-.17.23-.12.18-.08s.21-.06.24-.12-.05-.04-.05-.04-.04.01-.18.07c-.14.06-.51.24-.51.24l-.42.2-.5.23s-.31.13-.4.16c-.08.03-.32.14-.35.15l-.22.05-.51.2c-.04.01-.77.21-.89.23-.12.03-.32.1-.34.08-.02-.02.36-.42.4-.46l.44-.29.37-.25.32-.27.27-.23.23-.2.69-.45h.01l.9-.27.8-.15 1.04-.12.64-.03.7-.09s.07.06.03.09c-.09.08-1.36.67-1.34.68.01 0 .01 0 0 0 .03.02.07.02.1 0l.3-.09.35-.21.3-.17c.02 0 .21-.08.11.04-.1.13-.27.26-.27.26Z"
    ></path><path
      fill="#a6bcb2"
      d="M20.09 11.25c-.27.02-.7 0-.7 0s-.57-.09-1.23-.18c-.67-.09-1.26.02-1.26.02l-.39.12s-.45.21-.67.29c-.22.08-.57.24-.57.24l-.58.39-.4.08h-.35l.02.11h.29l.48.03s.89.17 1.36.3c.47.13.96.02 1.17 0 .21-.02 1.17-.35 1.36-.41s1.59-.82 1.59-.82c.03-.09-.03-.17-.12-.17Zm-.59.47-.31.15-.15.08-.67.28-.33.1-.47.15-.58.09h-.21l-.23.03h-.19l-.28-.02-.41-.07-.38-.11-.17-.05c-.02-.01-.09-.07.05-.06.16.01.41.03.41.03l.56.08h.09s.1.05.08.03c-.02-.02-.04-.05-.1-.07-.05-.02-.14-.02-.15-.02l-.13-.02h-.07v-.02h-.02s-.03-.06 0-.07c.01 0 .03-.01.05-.01.09 0 .25-.02.25-.02h.14l.27-.06.36-.07.23-.05.18-.03.26-.06.18-.04.14-.03s.15 0 .18-.04c.03-.03-.03-.03-.03-.03s-.03 0-.13.02c-.1.01-.38.08-.38.08l-.31.07-.38.07s-.23.04-.3.05c-.06 0-.24.04-.26.05h-.16l-.38.05c-.03 0-.56.02-.64.01-.08 0-.24.02-.24 0s.31-.22.34-.25l.34-.13.29-.11.26-.13.22-.11.18-.1.54-.19.65-.03.56.03.72.09.44.09.49.05s.04.05 0 .07c-.07.04-1.02.23-1.01.24.02.02.04.02.06.02h.22v-.02l.27-.08.23-.06c.02 0 .15-.02.07.04-.09.07-.22.13-.22.13ZM4.07 12.39c.27.03.69.14.69.14s.54.2 1.18.43c.64.23 1.24.24 1.24.24l.4-.04s.47-.11.7-.15c.22-.03.6-.12.6-.12l.62-.27h.4l.35.06v-.1l-.28-.06-.46-.13s-.85-.35-1.29-.58c-.44-.23-.94-.21-1.15-.23-.21-.02-1.2.1-1.39.12s-1.69.49-1.69.49c-.04.08 0 .18.09.19Zm.64-.34.32-.08.16-.04.69-.14.34-.03.49-.05.59.03.21.03.23.03.19.05.27.07.39.15.36.19.16.08c.02.02.08.09-.06.05-.15-.05-.4-.12-.4-.12l-.53-.19-.09-.03s-.09-.06-.07-.04c.02.03.03.05.09.09.05.03.13.05.14.05l.12.04.07.03h.02s.02.06 0 .07h-.05c-.09 0-.25-.03-.25-.03l-.14-.03H6.65l-.18.01h-.14s-.15-.03-.18 0c-.04.03.02.04.02.04H7.39s.23.01.3.02h.27l.15.03.38.03c.03 0 .55.1.63.12.08.02.23.03.24.05 0 .02-.33.16-.37.17l-.35.05-.3.05-.27.07-.23.07-.2.06-.56.08-.65-.1-.55-.15-.7-.23-.42-.18-.47-.15s-.03-.06 0-.07c.07-.02 1.04-.02 1.03-.03-.01-.02-.04-.03-.06-.03l-.22-.03-.27.03-.23.02c-.02 0-.15 0-.06-.06.1-.05.24-.08.24-.08Z"
    ></path></svg
  >
  <div class="post-detail__meta">
    <PostMeta
      publishedAt={post.publishedAt}
      tags={post.tags}
      estimatedReadingTime={post.estimatedReadingTime}
    />
  </div>

  <div class="blog-post blog-wrapper">
    <div class="blog-post__content">
      <PortableText portableText={post.body} />
    </div>

    <CopyLinkButton slug={post.slug.current} />
  </div>
  <!-- Hidden categories for search indexing -->
  <div
    aria-hidden="true"
    style="position:absolute; width: 0; height: 0;  overflow:hidden;"
  >
    Categories: {post.category ? post.category.title : "None"}
  </div>
</article>

<style>
  h1 {
    padding: var(--spacing-lg) var(--spacing-md);
    font-size: calc(var(--fs-fluid-h1) + 0.05rem);
    line-height: var(--lh-tight);
  }

  .decorative-svg {
    display: none;
  }

  /* mq */

  @media (width > 768px) {
    .post-detail__hero {
      max-width: 900px;
      margin-inline: auto;
      padding-inline: var(--spacing-lg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .decorative-svg {
      display: block;
      width: 140px; /* full width */
      height: auto;
      margin-inline: auto; /* center the svg */
      margin-bottom: var(--spacing-xxl);
    }

    .post-detail_hero.img {
      width: 100%;
      height: auto;
      max-height: 400px;
      object-fit: cover;
      border-radius: calc(var(--border-radius) * 2.5);
      box-shadow: var(--box-shadow);
      margin-bottom: var(--spacing-lg);
      margin-top: var(--spacing-lg);
    }

    .post-detail__meta {
      display: flex;
      justify-content: center;
    }

    h1 {
      font-size: var(--fs-xxl);
      font-weight: 600;
      text-align: center;
    }
  }
</style>
